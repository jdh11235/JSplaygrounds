<!-- Copyright (c) 2014 Jonathan Herman - MIT License -->
<!-- http://jdh11235.github.io/JSplaygrounds/share-hash.html -->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>share-hash</title>
</head>
<body>

	<div id="data"></div>

<script>

	var $data = document.getElementById('data');

	function init () {
		loadURLdata();
	}

	function loadDataset () {
		var dataset = JSON.parse(localStorage.dataset);
		for (each in dataset) {
			//TODO: create html elements
		}
	}

	function saveDataset () {

	}

	function newData (data) {
		//TODO: add new tab with data
		console.log(data);
	}

	function displayError (message) {
		//TODO: show message in html
		console.log(message);
	}

	function getURLdata () {
		var data;
		try {
			data = JSON.parse(decodeURIComponent(location.hash).substring(1));
		} catch (ERR) {
			displayError(ERR);
			return false;
		}
		return data;
	}

	function makeURL (data) {
		return location.origin + location.pathname + '#' +
			encodeURIComponent(JSON.stringify(data));
	}

	function loadURLdata () {
		if (location.hash !== '') {
			var data;
			if (data = getURLdata()) {
				newData(data);
			}

			location.hash = '';
		}
	}

	window.onload = init;
	window.onhashchange = loadURLdata;

</script>
</body>
</html>
