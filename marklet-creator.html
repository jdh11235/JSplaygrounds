<!-- Copyright (c) 2014 Jonathan Herman - MIT License (http://opensource.org/licenses/MIT) -->
<!--
hosted version:
	http://jdh11235.github.io/JSplaygrounds/marklet-creator.html
more info:
	http://github.com/jdh11235/JSplaygrounds
-->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>marklet-creator</title>

	<style>
		.marklet {
			background-color: black;
			color: lime;
			padding: 0.5em;
			font-family: sans-serif;
		}
	</style>
</head>
<body>
	<textarea id="inputBox" placeholder="put JavaScript here"></textarea>

	<button onclick="processScript()">Process</button>
	<button onclick="clearScript()">Clear</button>

	<hr>

	<textarea id="outputBox" placeholder="processed marklet source output"></textarea>

	<br style="margin-bottom: 1em;">

	<i>bookmarklet (drag to your Bookmarks Bar)</i>
	<input type="text" id="markletName" oninput="processName()" placeholder="rename bookmarklet">
	<a href="#" id="markletButton" class="marklet"></a>

	<hr>

	<center>
		<a href="http://github.com/jdh11235/JSplaygrounds">More Info...</a>
	</center>

	<script>
		var inputBox = document.getElementById('inputBox'),
			outputBox = document.getElementById('outputBox'),
			markletName = document.getElementById('markletName'),
			markletButton = document.getElementById('markletButton');
		//TODO: save inputBox and markletName in localStorage
		processName();
		processScript();

		function displayName(name) {
			markletButton.innerHTML = name;
		}

		function processName() {
			var name = markletName.value;
			if (!name) name = 'Bookmarklet';
			displayName(name);
		}

		function displayMarklet(text) {
			outputBox.value = text;
			markletButton.href = text;
		}

		function markletify(text) {

			//remove single-line comments
			text = text.replace(/\/\/.*[\n\r]*/g, '');

			//replace whitespace and newlines with %20
			text = text.replace(/\s+/g, '%20');

			//wrap into JavaScript URL
			text = 'javascript:{' + text + '};void(0)';

			return text;
		}

		function processScript() {
			var text = markletify(inputBox.value);
			displayMarklet(text);
		}

		function clearScript() {
			inputBox.value = '';
			processScript();
		}
	</script>
</body>
</html>
